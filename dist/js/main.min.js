!function(e){var t=e.app||(e.app={}),s=e.Backbone.Model.extend({defaults:function(){return{name:"",code:"",instructor:"",classes:[]}},addClass:function(e){if(_.isObject(e)&&e.hasOwnProperty("day")&&e.hasOwnProperty("start")&&e.hasOwnProperty("end"))return this.attributes.classes.push(e),this.trigger("change"),this.isValid()},removeClass:function(e){var t;if(_.isNumber(e)){if(e>=0&&e<this.attributes.classes.length)return this.attributes.classes.splice(e,1)}else if(_.isObject(e)&&(t=this.attributes.classes.indexOf(e))>-1)return this.attributes.classes.splice(t,1)},validate:function(e){var t=[];if(e.hasOwnProperty("name")&&_.isEmpty(e.name)&&t.push({attr:"name",message:"Course.name must not be an empty string."}),e.hasOwnProperty("code")&&_.isEmpty(e.code)&&t.push({attr:"code",message:"Course.code must not be an empty string."}),e.hasOwnProperty("instructor")&&_.isEmpty(e.instructor)&&t.push({attr:"instructor",message:"Course.instructor must not be an empty string."}),e.hasOwnProperty("classes")&&!_.isArray(e.classes)?t.push({attr:"classes",message:"Course.classes must be an array."}):e.classes.length>0&&e.classes.forEach(function(e){e.hasOwnProperty("day")&&e.hasOwnProperty("start")&&e.hasOwnProperty("end")||t.push({attr:"classes",message:"Course.classes must be an array of {day, start, end} objects."})}),t.length>0)return t}});t.models||(t.models={}),t.models.Course=s}(this),function(e){var t=e.app||(e.app={}),s=e.Backbone.Collection.extend({model:t.models.Course,url:"/courses",localStorage:new Backbone.LocalStorage("Schedule"),forDay:function(e){return this.filter(function(t){var s;return t.get("classes").forEach(function(t){s=t.day.toLowerCase()===e.toLowerCase()}),s})},forCode:function(e){return this.filter(function(t){return t.get("code").toLowerCase()===e.toLowerCase()})},forName:function(e){return this.filter(function(t){return t.get("name").toLowerCase()===e.toLowerCase()})},forInstructor:function(e){return this.filter(function(t){return t.get("instructor").toLowerCase()===e.toLowerCase()})}});t.collections||(t.collections={}),t.collections.Schedule=s}(this),function(e){var t=e.app||(e.app={});AppView=Backbone.View.extend({el:"body",events:{"click a.add-course":"renderCourseView"},initialize:function(){this.scheduleView=new t.views.ScheduleView({collection:t.schedule}),this.$el.find(".schedule-display").html(this.scheduleView.render().el)},renderCourseView:function(e,s){this.courseView&&this.courseView.remove(),this.courseView=s?new t.views.CourseView({model:s}):new t.views.CourseView,this.$el.find(".course-display").html(this.courseView.render().el),e.preventDefault()}}),t.views||(t.views={}),t.views.AppView=AppView}(this),function(e){var t=e.app||(e.app={}),s=e.Backbone.View.extend({tagName:"div",template:Handlebars.templates["course-view-template"],errorTemplate:Handlebars.templates["course-view-errors-template"],events:{"submit .course-form":"addUpdateCourse","click .btn.add-section":"addSection","click .btn.add-class":"addClass","click .btn.cancel-class":"resetClassForm","click .btn.close-course":"removeView"},initialize:function(e){this.options=e||{},this.newCourse=!1,this.options.model||(this.model=new t.models.Course({}),this.newCourse=!0),this.listenTo(this.model,"change",this.render)},render:function(){return this.$el.html(this.template(this.model.attributes)),this.newCourse&&this.$el.find(".times").addClass("hidden"),this},renderErrors:function(){this.$el.find(".errors").html(this.errorTemplate({errors:this.model.validationError}))},removeView:function(){this.remove()},addSection:function(e){this.$el.find(".time-controls").removeClass("hidden"),this.$el.find(".btn-add-course-time").addClass("hidden"),e.preventDefault()},resetClassForm:function(){this.$el.find(".time-controls").addClass("hidden"),this.$el.find(".btn-add-course-time").removeClass("hidden"),this.$el.find("#course-time-day")[0].options[0].selected="selected",this.$el.find("#course-time-start").val(""),this.$el.find("#course-time-end").val("")},addClass:function(){var e=this.$el.find("select#course-time-day").val(),t=this.$el.find("input#course-time-start").val(),s=this.$el.find("input#course-time-end").val();this.model.addClass({day:e,start:t,end:s}),this.model.isValid()?this.model.save():this.renderErrors()},addUpdateCourse:function(e){this.model.set({code:this.$el.find("input#course-code").val(),name:this.$el.find("input#course-name").val(),instructor:this.$el.find("input#course-instructor").val()},{validate:!0}),this.model.isValid()?(this.newCourse&&(t.schedule.add(this.model),this.newCourse=!1,this.render(),t.router.navigate("courses/"+this.model.id)),this.model.save()):this.renderErrors(),e.preventDefault()}});t.views||(t.views={}),t.views.CourseView=s}(this),function(e){var t=e.app||(e.app={}),s=Backbone.View.extend({tagName:"div",template:Handlebars.templates["schedule-view-template"],events:{"click .edit":"modifyCourse"},initialize:function(e){this.options=e||{},this.options.collection||(this.collection=new t.collections.Schedule),this.listenTo(this.collection,"change",this.render),this.listenTo(this.collection,"add",this.render)},render:function(){return this.$el.html(this.template({courses:this.collection.models})),this},modifyCourse:function(e){t.appView.renderCourseView(e,this.collection.get(e.currentTarget.dataset.id)),t.router.navigate("courses/"+e.currentTarget.dataset.id,{trigger:!0})}});t.views||(t.views={}),t.views.ScheduleView=s}(this),function(e){var t=e.app||(e.app={}),s=e.Backbone.Router.extend({routes:{"":"index","courses/:id":"renderCourse"},index:function(){t.schedule.fetch()},renderCourse:function(e){t.schedule.fetch(),t.appView.renderCourseView({preventDefault:function(){return!1}},t.schedule.get(e))}});t.routers||(t.routers={}),t.routers.AppRouter=s}(this),function(e){var t=e.app||(e.app={});t.schedule=new t.collections.Schedule,t.appView=new t.views.AppView,t.router=new t.routers.AppRouter,Backbone.history.start()}(this),function(){for(var e,t=function(){},s=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeline","timelineEnd","timeStamp","trace","warn"],i=s.length,r=window.console=window.console||{};i--;)r[e=s[i]]||(r[e]=t)}();